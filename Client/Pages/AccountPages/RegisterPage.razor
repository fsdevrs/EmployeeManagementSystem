@page "/identity/account/register"
@using System.ComponentModel.DataAnnotations
@layout AuthLayout

<div class="login-box">
    <div class="login-header">
        <header>Register</header>
    </div>
    <div class="auth-logo">
        <img src="/images/auth-logo.png" alt="Auth Logo" />
    </div>
    <EditForm Enhance Model="validationModel" OnValidSubmit="HandleRegistration">
        <DataAnnotationsValidator />
        <div class="input-box">
            <InputText @bind-Value="validationModel.FullName" class="input-field" placeholder="Full Name" type="text" autocomplete="off"></InputText>
            <ValidationMessage For="@(() => validationModel.FullName)"  />
        </div>
        <div class="input-box">
            <InputText @bind-Value="validationModel.Email" class="input-field" placeholder="Email" type="email" autocomplete="off"></InputText>
            <ValidationMessage For="@(() => validationModel.Email)"  />
        </div>
		 <div class="input-box">
            <input type="password" @bind="validationModel.Password" class="input-field" placeholder="Password" autocomplete="off" />
            <ValidationMessage For="@(() => validationModel.Password)"  />
        </div>
		 <div class="input-box">
            <input type="password" @bind="validationModel.ConfirmPassword" class="input-field" placeholder="Confirm Password" autocomplete="off" />
            <ValidationMessage For="@(() => validationModel.ConfirmPassword)"  />
        </div>
        <div class="input-submit">
            <button class="submit-btn" id="submit" type="submit"></button>
            <label for="submit">Register</label>
        </div>
        <div class="sign-up-link">
            <p>Already have an account? <a href="identity/account/login">Login now.</a></p>
        </div>
    </EditForm>
</div>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
    }


    body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: #fff;
    }

    .login-box {
        display: flex;
        justify-content: center;
        flex-direction: column;
        width: 440px;
        height: 480px;
        padding: 30px;
    }

    .login-header {
        text-align: center;
        margin: 20px 0 10px 0;
    }

        .login-header header {
            color: #333;
            font-size: 50px;
            font-weight: 600;
        }

    .auth-logo {
        align-self: center;
        margin: 20px 0 20px 0;
    }

        .auth-logo img {
            height: 75px;
            width: auto;
            align-self: center;
        }

    .input-box .input-field {
        width: 100%;
        height: 60px;
        font-size: 17px;
        padding: 0 25px;
        margin-bottom: 15px;
        border-radius: 30px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0px 5px 10px 1px rgba(0,0,0, 0.05);
        outline: 1px solid rgba(0, 0, 0, 0.1);
        transition: .3s;
    }

    ::placeholder {
        font-weight: 500;
        color: #222;
    }

    .input-field:focus {
        width: 105%;
    }

    .input-field:hover {
        width: 105%;
    }

    .forgot {
        display: flex;
        justify-content: space-between;
        margin-bottom: 40px;
    }

    section {
        display: flex;
        align-items: center;
        font-size: 14px;
        color: #555;
    }

    #check {
        margin-right: 7px;
    }

    a {
        text-decoration: none;
    }

        a:hover {
            text-decoration: underline;
        }

    section a {
        color: #555;
    }

    .input-submit {
        position: relative;
    }

    .submit-btn {
        width: 100%;
        height: 60px;
        background: #222;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        transition: .3s;
    }

    .input-submit label {
        position: absolute;
        top: 45%;
        left: 50%;
        color: #fff;
        -webkit-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        cursor: pointer;
    }

    .submit-btn:hover {
        background: #000;
        transform: scale(1.05,1);
    }

    .sign-up-link {
        text-align: center;
        font-size: 15px;
        margin-top: 20px;
    }

        .sign-up-link a {
            color: #000;
            font-weight: 600;
            transition: .3s;
        }

        .error-message {
         color: red;
}
</style>

@code {

    public class ValidationModel
    {
        [Required(ErrorMessage ="Please enter Fullname!")]
        public string? FullName  {get; set;}

        [EmailAddress(ErrorMessage="Invalid Email Address!")]
        [Required(ErrorMessage ="Please enter email address!")]
        public string? Email { get; set; }

        [Required(ErrorMessage = "Password is required!")]
        public string? Password  { get; set; }

        [Required(ErrorMessage = "Confirm Password is required!")]
        [Compare("Password", ErrorMessage = "Passwords do not match!")]
        public string? ConfirmPassword { get; set; }
    }

    private ValidationModel validationModel = new ValidationModel();

    BaseLibrary.DTOs.Register User = new BaseLibrary.DTOs.Register();
    async Task HandleRegistration()
    {
        // Map user input to validationModel properties (if needed)
    validationModel.FullName = User.FullName;
    validationModel.Email = User.Email;
    validationModel.Password = User.Password;
    validationModel.ConfirmPassword = User.ConfirmPassword;

    // Perform validation on validationModel properties (using DataAnnotations or custom logic)

    // Example using DataAnnotations on ValidationModel
    var validationContext = new ValidationContext(validationModel);
    var validationResults = new List<ValidationResult>();
    Validator.TryValidateObject(validationModel, validationContext, validationResults, true);

    if (validationResults.Any())
    {
        // Display validation errors to user (e.g., using a modal or inline messages)
        return;
    }

    // Validation successful, copy data to User object (if needed)
    User.FullName = validationModel.FullName;
    User.Email = validationModel.Email;
    User.Password = validationModel.Password;
    User.ConfirmPassword = validationModel.ConfirmPassword;


        var result = await accountService.CreateAsync(User);
        if (result.Flag)
        {
            User = new();
        }
        else
        {
            
        }
    }
    
}
